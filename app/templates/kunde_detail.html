{% extends "base.html" %}

{% block title %}{{ kunde.name }}{% endblock %}

{% block content %}
<div class="card">
    <h2>{{ kunde.name }}</h2>
    <a href="/kunden/{{ kunde.id }}/bearbeiten" class="btn" style="margin-bottom: 1rem;">âœï¸ Bearbeiten</a>
    <form action="/kunden/{{ kunde.id }}/loeschen" method="POST" style="display: inline;">
        <button type="submit" class="btn btn-danger" onclick="return confirm('Kunde und alle zugehÃ¶rigen Login-Daten und Rapporte wirklich lÃ¶schen?')">ğŸ—‘ï¸ LÃ¶schen</button>
    </form>
    <p><strong>Email:</strong> {{ kunde.email or '-' }}</p>
    <p><strong>Telefon:</strong> {{ kunde.telefon or '-' }}</p>
    <p><strong>Adresse:</strong> {{ kunde.adresse or '-' }}</p>
    <p><strong>IT-Infrastruktur:</strong> {{ kunde.it_infrastruktur or '-' }}</p>
    <p><strong>Stundensatz:</strong> CHF {{ "%.2f"|format(kunde.stundensatz or 120.0) }}/h</p>
</div>

<div class="card">
    <h3>Login-Daten</h3>
    <a href="/login-daten/{{ kunde.id }}/neu" class="btn btn-success">â• Neue Login-Daten</a>
    
    {% if logins %}
    <table>
        <thead>
            <tr>
                <th>GerÃ¤tetyp</th>
                <th>Beschreibung</th>
                <th>Username</th>
                <th>Passwort</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for login in logins %}
            <tr>
                <td>{{ login.geraet_typ }}</td>
                <td>{{ login.beschreibung or '-' }}</td>
                <td>{{ login.username or '-' }}</td>
                <td>{{ login.passwort or '-' }}</td>
                <td>
                    <a href="/login-daten/{{ login.id }}/bearbeiten" class="btn btn-small">âœï¸</a>
                    <form action="/login-daten/{{ login.id }}/loeschen" method="POST" style="display: inline;">
                        <button type="submit" class="btn btn-small btn-danger" onclick="return confirm('Login-Daten wirklich lÃ¶schen?')">ğŸ—‘ï¸</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="margin-top: 1rem; color: #666;">Keine Login-Daten erfasst.</p>
    {% endif %}
</div>

<div class="card">
    <h3>Rapporte</h3>
    {% if rapporte %}
    <div style="margin-bottom: 1rem;">
        <a href="/rechnung/kunde/{{ kunde.id }}/konsolidiert" class="btn btn-success">ğŸ“„ Konsolidierte Rechnung erstellen</a>
        <details style="margin-top: 0.5rem;">
            <summary style="cursor: pointer; color: #666;">Mit Datumsfilter</summary>
            <form action="/rechnung/kunde/{{ kunde.id }}/konsolidiert" method="GET" style="margin-top: 0.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;">
                <label>Von: <input type="date" name="von_datum"></label>
                <label>Bis: <input type="date" name="bis_datum"></label>
                <button type="submit" class="btn btn-success">ğŸ“„ Rechnung erstellen</button>
            </form>
        </details>
    </div>
    <table>
        <thead>
            <tr>
                <th>Datum</th>
                <th>Thema</th>
                <th>Dauer</th>
                <th>Kosten</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for rapport in rapporte %}
            <tr>
                <td>{{ rapport.datum|date_ch }}</td>
                <td>{{ rapport.thema }}</td>
                <td>{{ rapport.dauer_minuten }} min</td>
                <td>CHF {{ "%.2f"|format(rapport.kosten or 0) }}</td>
                <td>
                    {% if rapport.bezahlt %}
                        âœ… Bezahlt ({{ rapport.zahlungsart }})
                    {% else %}
                        â³ Offen
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="margin-top: 1rem; color: #666;">Keine Rapporte fÃ¼r diesen Kunden.</p>
    {% endif %}
</div>

<a href="/kunden" class="btn">ZurÃ¼ck zur Kundenliste</a>
{% endblock %}
